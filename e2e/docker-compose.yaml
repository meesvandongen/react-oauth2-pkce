services:
  # Dex Identity Provider
  dex:
    image: ghcr.io/dexidp/dex:latest
    restart: unless-stopped
    volumes:
      - ./dex/config.yaml:/etc/dex/config.yaml:ro
    ports:
      - "5556:5556"
    command: ["dex", "serve", "/etc/dex/config.yaml"]

  # Test web application for Playwright tests
  test-app:
    build:
      context: ./test-app
      dockerfile: Dockerfile
    restart: unless-stopped
    volumes:
      - ./test-app/src:/app/src
      - ./test-app/public:/app/public
    ports:
      - "3010:3010"
    environment:
      - VITE_DEX_URL=http://localhost:5556
    depends_on:
      - dex
