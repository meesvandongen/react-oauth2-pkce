# Dex configuration for OAuth2 PKCE testing
# Static user credentials for automated testing:
# Email: admin@example.com
# Password: password

issuer: http://localhost:5556/dex

storage:
  type: memory

web:
  http: 0.0.0.0:5556
  allowedOrigins:
    - "*"

telemetry:
  http: 0.0.0.0:5558

# Enable PKCE for public clients
oauth2:
  skipApprovalScreen: true
  alwaysShowLoginScreen: false
  responseTypes:
    - code
  grantTypes:
    - authorization_code
    - refresh_token

# Static clients configuration
staticClients:
  # Main test client with all features enabled
  - id: test-app
    name: Test Application
    redirectURIs:
      - http://localhost:3010/
      - http://localhost:3010/basic/
      - http://localhost:3010/autologin/
      - http://localhost:3010/localstorage/
      - http://localhost:3010/customstate/
      - http://localhost:3010/refresh/
      - http://localhost:3010/prepostlogin/
      - http://localhost:3010/extraparams/
      - http://localhost:3010/timing/
      - http://localhost:3010/absolute-expiry/
      - http://localhost:3010/popup/
      - http://localhost:3010/multitab/
      - http://localhost:3010/network/
      - http://localhost:3010/opaque-token/
      - http://localhost:3010/clear-url/
      - http://localhost:3010/logout-test/
      - http://localhost:3010/no-scope-refresh/
    public: true

# Token expiration settings for testing refresh token scenarios
expiry:
  # Very short token expiry for testing refresh
  idTokens: 5m
  accessTokens: 1m
  refreshTokens:
    validIfNotUsedFor: 30m
    absoluteLifetime: 1h
    reuseInterval: 30s

# Enable refresh tokens
enablePasswordDB: true

# Static users for testing
staticPasswords:
  - email: "admin@example.com"
    hash: "$2a$10$2b2cU8CPhOTaGrs1HRQuAueS7JTT5ZHsHSzYiFPm1leZck7Mc8T4W"
    username: "admin"
    userID: "1234"

# Connectors - using local connector for static passwords
connectors: []

# Frontend configuration
frontend:
  issuer: Dex Test Server
  theme: light
